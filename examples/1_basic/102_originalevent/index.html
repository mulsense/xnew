<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <script src="../../dist/xnew.js"></script>
  <script src="../../thirdparty/tailwindcss/playcdn.js"></script>
</head>

<body class="m-0 p-0 w-full h-screen">
  <div id="main" class="relative w-full h-full flex flex-col overflow-hidden"></div>

  <script>
    xnew(document.querySelector('#main'), Main);

    function Main(unit) {
      xnew.nest('<div class="h-full flex flex-col">');
      xnew.nest('<div class="flex-auto flex items-start gap-4 p-4">');
      xnew(LocalEvent);
      xnew(GlobalEvent);
      xnew(ProtectedGlobalEvent);
    }

    // --- local event (blue theme) ---

    function LocalEvent(unit) {
      xnew.nest('<div class="flex-1 p-3 border-2 rounded-lg border-blue-500 bg-blue-50 flex flex-col gap-3">');
      xnew('<p class="font-bold text-blue-800">', 'local event');

      const inner = xnew((unit) => {
        xnew.nest('<div class="p-3 border rounded-lg border-yellow-600 bg-yellow-50 flex flex-col items-center gap-2">');
        xnew(Button, { name: 'emit -myclick' }).on('click', () => xnew.emit('-myclick'));
      });

      const p = xnew('<p class="text-blue-700">', '-myclick: 0');
      let count = 0;
      inner.on('-myclick', () => p.element.textContent = `-myclick: ${++count}`);
    }

    // --- global event (green theme) ---

    function GlobalEvent(unit) {
      xnew.nest('<div class="flex-1 p-3 border-2 rounded-lg border-green-500 bg-green-50 flex flex-col gap-3">');
      xnew('<p class="font-bold text-green-800">', 'global event');

      xnew((unit) => {
        xnew.nest('<div class="p-3 border rounded-lg border-yellow-600 bg-yellow-50 flex flex-col items-center gap-2">');
        xnew('<p class="font-bold text-yellow-800">', 'not protected');
        const p = xnew('<p class="text-yellow-700">', '+myclick: 0');
        let count = 0;
        unit.on('+myclick', () => p.element.textContent = `+myclick: ${++count}`);
        xnew(Button, { name: 'emit +myclick' }).on('click', () => xnew.emit('+myclick'));
      });

      xnew(Button, { name: 'emit +myclick (outer)' }).on('click', () => xnew.emit('+myclick'));
    }

    // --- protected global event (purple + slate theme) ---

    function ProtectedGlobalEvent(unit) {
      xnew.nest('<div class="flex-1 p-3 border-2 rounded-lg border-violet-600 bg-violet-50 flex flex-col gap-3">');
      xnew('<p class="font-bold text-violet-800">', 'global event');

      xnew((unit) => {
        xnew.protect();
        xnew.nest('<div class="p-3 border rounded-lg border-slate-400 bg-slate-100 flex flex-col items-center gap-2">');
        xnew('<p class="font-bold text-slate-700">', 'protected');
        const p = xnew('<p class="text-slate-600">', '+myclick: 0');
        let count = 0;
        unit.on('+myclick', () => p.element.textContent = `+myclick: ${++count}`);
        xnew(Button, { name: 'emit +myclick' }).on('click', () => xnew.emit('+myclick'));
      });

      xnew(Button, { name: 'emit +myclick (outer)' }).on('click', () => xnew.emit('+myclick'));
    }

    // ---

    function Button(unit, { name = 'button' }) {
      xnew.nest('<button class="px-3 py-1 border rounded-lg cursor-pointer bg-white hover:bg-gray-100 border-gray-300 text-gray-700">');
      unit.element.textContent = name;
    }

  </script>
</body>

</html>
