<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <script src="../../dist/xnew.js"></script>
  <script src="../../thirdparty/tailwindcss/playcdn.js"></script>
</head>

<body class="m-0 p-0 w-full h-screen overflow-hidden">
  <div id="main" class="relative w-full h-full"></div>

  <script>
    xnew(document.querySelector('#main'), Main);
    
    function Main(unit) {
      xnew.nest('<div class="flex gap-4">');
      xnew(MinusEvent);
      xnew(PlusEvent);
    }
    
    function MinusEvent(unit) {
      xnew.nest('<div class="w-64 m-4 p-4 text-lg border rounded-lg flex flex-col items-center gap-4">');
      xnew('<p>', '- event demo');

      const div = xnew((unit) => {
        xnew.nest('<div class="w-56 m-4 p-4 text-lg border rounded-lg flex flex-col items-center gap-4">');

        const button = xnew(Button, { text: 'inner button' });
        button.on('click', ({ event }) => xnew.emit('-myclick'));
      });

      const p = xnew('<p>', 'count 0');
      let count = 0;
      div.on('-myclick', () => p.element.textContent = `count ${++count}`);
    }

    function PlusEvent(unit) {
      xnew.nest('<div class="w-64 m-4 p-4 text-lg border rounded-lg flex flex-col items-center gap-4">');
      xnew('<p>', '+ event demo');

      xnew(Counter, { text: 'non protected counter' });
      xnew(Counter, { text: 'protected counter', protect: true });

      const button = xnew(Button, { text: 'outer button' });
      button.on('click', ({ event }) => xnew.emit('+mycountup'));
    }

    function Counter(unit, { text, protect = false } = {}) {
      if (protect) {
        xnew.protect();
      }
      xnew.nest('<div class="w-56 m-4 p-4 text-lg border rounded-lg flex flex-col items-center gap-4">');
      xnew('<p class="font-bold">', text);
      const p = xnew('<p>', 'count 0');

      let count = 0;
      unit.on('+mycountup', () => {
        p.element.textContent = `count ${++count}`;
      }); 

      const button = xnew(Button, { text: 'inner button' });
      button.on('click', ({ event }) => xnew.emit('+mycountup'));
    }

    function Button(unit, { text = 'button' } = {}) {
      xnew.nest('<button class="px-2 border rounded-lg cursor-pointer hover:bg-gray-200">', text);
    }

  </script>
</body>

</html>