<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <script src="../../dist/xnew.js"></script>
  <script src="../../thirdparty/tailwindcss/playcdn.js"></script>
</head>

<body class="m-0 p-0 w-full h-screen overflow-hidden">
  <div id="main" class="relative w-full h-full"></div>
  <script>
    xnew(document.querySelector('#main'), (unit) => {
      xnew.nest('<div class="p-2">');
      xnew(MyPanel);
    });

    function MyPanel(panel) {
      xnew.nest('<div class="w-64 p-1 border rounded-lg shadow-lg bg-white">');
      xnew.extend(GUIPanel, { name: 'My Panel', open: true });
      xnew('<div">', 'My Panel');

      const params = {
        data: 20,
      };

      panel.group('group 1', (group) => {
        group.button('button 1');
        group.button('button 2');
        group.button('button 3');
        group.border();
        xnew('<div">', 'ccc');
      });
      xnew('<div">', 'xxx');
        panel.param(params, 'data');
      return;

      xnew((unit) => {
        xnew.extend(PanelGroup, { name: 'group 2', open: true });

        xnew((unit) => {
          xnew('<div class="text-sm flex justify-between">', (unit) => {
              xnew('<div class="flex-1">', 'range 1');
              xnew('<div key="status" class="flex-none">', '25');
          });
          const input = xnew('<input type="range" name="range 1" min="0" max="100" value="25" class="m-0 w-full">');
          input.on('input', ({ event }) => {
            unit.element.querySelector('[key="status"]').textContent = event.target.value;
          });
        });

        xnew((unit) => {
          xnew('<div class="flex justify-between">', (unit) => {
              xnew('<div class="flex-1">', 'radio 1');
          });
          xnew('<label class="block">', () => {
            xnew('<input type="radio" name="radio 1" value="radio A" checked>');
            xnew('<span class="mx-2">', 'radio A');
          });
          xnew('<label class="block">', () => {
            xnew('<input type="radio" name="radio 1" value="radio B">');
            xnew('<span class="mx-2">', 'radio B');
          });
          xnew('<label class="block">', () => {
            xnew('<input type="radio" name="radio 1" value="radio C">');
            xnew('<span class="mx-2">', 'radio C');
          });
        })

        xnew((unit) => {
          xnew('<div class="flex justify-between">', (unit) => {
              xnew('<div class="flex-1">', 'text 1');
          });
          xnew('<input type="text" name="text 1" value="text" class="px-2 w-full h-8 border rounded-lg">');
        })
      });
    }

    function GUIPanel(unit, { name, open = true } = {}) {
      const system = xnew(xnew.basics.OpenAndClose, { state: open ? 1.0 : 0.0 });
      
      xnew('<div class="flex items-center cursor-pointer">', (unit) => {
        unit.on('click', () => system.toggle());
        xnew((unit) => {
          xnew.nest('<svg viewBox="0 0 12 12" class="mr-1 size-4" fill="none" stroke="currentColor">');
          xnew('<path d="M6 2 10 6 6 10" />');
          system.on('-transition', ({ state }) => unit.element.style.transform = `rotate(${state * 90}deg)`);  
        });
        xnew('<div>', name);
      });

      const outer = xnew.nest('<div class="overflow-hidden">');
      const inner = xnew.nest('<div class="p-0.5 flex flex-col box-border">');
      system.on('-transition', ({ state }) => {
        outer.style.height = state < 1.0 ? inner.offsetHeight * state + 'px' : 'auto';
        outer.style.opacity = state;
      });
      return {
        group(name, inner) {
          const group = xnew((unit) => {
            xnew.extend(GUIPanel, { name, state: 0.0 });
            inner(unit);
          });
          return group;
        },
        button(key) {
          const button = xnew('<button class="m-0.5 border rounded-lg hover:bg-gray-200 cursor-pointer">');
          button.element.textContent = key;
          button.on('click', ({ event }) => {
            xnew.emit('-click.' + key, { event });
          });
          return button;
        },
        param(object, key, {} = {}) {
          
          if (typeof object[key] === 'number') {
            const paramer = xnew((unit) => {
              xnew('<div class="text-sm flex justify-between">', (unit) => {
                  xnew('<div class="flex-1">', key);
                  xnew('<div key="status" class="flex-none">', object[key]);
              });
              const input = xnew('<input type="range" name="' + key + '" min="0" max="100" value="' + object[key] + '" class="m-0 w-full">');
              input.on('input', ({ event }) => {
                object[key] = event.target.value;
                unit.element.querySelector('[key="status"]').textContent = event.target.value;
              });
            });
            return paramer;
          }
        },
        border() {
          xnew('<div class="my-2 border-t">');
        }
      }
    }

  </script>
</body>

</html>