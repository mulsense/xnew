<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <script src="../../dist/xnew.js"></script>
</head>

<body style="margin: 0; height: 100vh; overflow: hidden;">
  <div id="main" style="width: 100%; height: 100%; overflow: hidden;"></div>
  <script>
    xnew("#main", (main) => {
      xnew((self) => {
        xnew.extend(WorkSpace, {
          style: {
            position: 'relative',
            width: '80%',
            height: '80%',
            maxHeight: '100%',
            // background: '#AAA',
            userSelect: 'none',
          }
        });
        const ws = xnew.context('xnew.WorkSpace');
        ws.move({ position: { x: 0, y: 0 }, scale: 1 });
        xnew({ tag: 'span', style: {
          background: '#FFF',
        } }, 'Workspace Example');

      });
    });

function WorkSpace(self, attributes = {}) {
    xnew.context('xnew.WorkSpace', self);

    const current = {
        position : { x: 0, y: 0 },
        rotation: 0,
        scale: 1
    }

    const fix = xnew.nest(attributes);
    fix.style.overflow = 'hidden';

    xnew(Controller);

    const base = xnew.nest({ style: { position: 'absolute', top: '50%', left: '50%' } });
    xnew.nest({ style: { position: 'absolute' } });
    return {
        get transform() {
            return current;
        },
        move(transform) {
            if (transform.position) {
                current.position = transform.position;
            }
            if (transform.rotation) {
                current.rotation = transform.rotation;
            }
            if (transform.scale) {
                current.scale = transform.scale;
            }
        },
        update() {
            let text = '';
            if (current.position) {
                text += `translate(${current.position.x}px, ${current.position.y}px) `;
            }
            if (current.rotation) {
                text += `rotate(${current.rotation}deg) `;
            }
            if (current.scale) {
                text += `scale(${current.scale}) `;
            }
            base.style.transform = text;
        }
    }
}
function Controller(self) {
    const ws = xnew.context('xnew.WorkSpace');
    self.on('touchstart contextmenu wheel', (event) => event.preventDefault());

    self.on('+translate', (delta) => {
        ws.move({
            position: {
                x: ws.transform.position.x - delta.x,
                y: ws.transform.position.y + delta.y
            }
        });
    });

    const user = xnew(xnew.UserEvent);

    user.on('-dragmove', ({ event, delta }) => {
        if (event.target == user.element || 1) {
            if (event.buttons & 1) {
                xnew.emit('+translate', { x: -delta.x, y: +delta.y });
            }
        }
    });
}

  </script>
</body>

</html>